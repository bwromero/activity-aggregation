<div class="container">
  <mat-card class="aggregation-card">
    <mat-card-header>
      <mat-card-subtitle>{{ UI_CONFIG.messages.groupByLabel }}</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <app-activity-filter
        [isProjectSelected]="service.isFieldSelected(ACTIVITY_FIELDS.PROJECT)()"
        [isEmployeeSelected]="service.isFieldSelected(ACTIVITY_FIELDS.EMPLOYEE)()"
        [isDateSelected]="service.isFieldSelected(ACTIVITY_FIELDS.DATE)()"
        (fieldToggled)="service.toggleField($event)"
      />

      @if (service.loading()) {
        <div class="aggregation-card__loading">
          <mat-spinner [diameter]="UI_CONFIG.spinner.diameter"></mat-spinner>
        </div>
      }

      @if (service.error()) {
        <div class="aggregation-card__error">{{ service.error() }}</div>
      }

      @if (service.hasData()) {
        <app-activity-table
          [data]="service.data()"
          [displayedColumns]="service.displayedColumns()"
        />

        <!-- Pagination Controls -->
        <div class="aggregation-card__pagination">
          <mat-paginator
            [length]="service.totalElements()"
            [pageSize]="service.pageSize()"
            [pageSizeOptions]="[10, 25, 50, 100]"
            [pageIndex]="service.currentPage()"
            (page)="onPageChange($event)"
            showFirstLastButtons>
          </mat-paginator>

          <!-- Pagination Info -->
          <div class="aggregation-card__pagination-info">
            Showing 
            {{ (service.currentPage() * service.pageSize()) + 1 }} 
            to 
            {{ Math.min((service.currentPage() + 1) * service.pageSize(), service.totalElements()) }}
            of 
            {{ service.totalElements() }} 
            results
          </div>
        </div>
      }

      @if (service.showNoData()) {
        <div class="aggregation-card__no-data">{{ UI_CONFIG.messages.noData }}</div>
      }
    </mat-card-content>
  </mat-card>
</div>